<div class="canvas-container">
  <div class="controls">
    <button
      class="icon-btn"
      (click)="toggleDashedMode()"
      [class.active]="drawMode && lineStyle === 'dashed'"
      title="Desenhar tracejado"
    >
      <img src="canva/linha-tracejada.png" alt="Tracejado" class="icon-btn-img" />
    </button>

    <button
      class="icon-btn"
      (click)="toggleSolidMode()"
      [class.active]="drawMode && lineStyle === 'solid'"
      title="Desenhar sólido"
    >
      <img src="canva/linha-diagonal.png" alt="Sólido" class="icon-btn-img" />
    </button>

    <button
      class="icon-btn"
      (click)="toggleDeleteMode()"
      [class.active]="deleteMode"
      title="Apagar linha"
    >
      <img src="canva/borracha.png" alt="Apagar linha" class="icon-btn-img" />
    </button>

    <!-- Botão para apagar serviços -->
    <button
      class="icon-btn"
      (click)="toggleServiceDeleteMode()"
      [class.active]="serviceDeleteMode"
      title="Apagar serviço"
    >
      <img src="canva/lixeira.png" alt="Apagar serviço" class="icon-btn-img" />
    </button>
  </div>

  <div
    #canvasRef
    class="canvas"
    [class.service-delete-mode]="serviceDeleteMode"
    cdkDropList
    id="canvas-drop"
    [cdkDropListConnectedTo]="['palette-drop']"
    (cdkDropListDropped)="onDrop($event)"
    (click)="onCanvasClick($event)"
  >
    <svg class="connections">
      <ng-container *ngFor="let conn of connections; let i = index">
        <line
          class="hit-area"
          (click)="onLineClick(i)"
          [attr.x1]="conn.x1"
          [attr.y1]="conn.y1"
          [attr.x2]="conn.x2"
          [attr.y2]="conn.y2"
        />
        <line
          class="visible-line"
          [ngClass]="conn.style"
          [attr.x1]="conn.x1"
          [attr.y1]="conn.y1"
          [attr.x2]="conn.x2"
          [attr.y2]="conn.y2"
        />
      </ng-container>
    </svg>

    <div
      class="node"
      *ngFor="let svc of droppedServices; let i = index"
      #nodeElem
      [ngStyle]="{ left: svc.x + 'px', top: svc.y + 'px' }"
      (click)="onServiceClick(i, $event)"
      (mousedown)="startNodeDrag(i, $event)"
    >
      <img [src]="svc.icon" class="node-icon" />
      <div class="node-label">{{ svc.label }}</div>
    </div>
  </div>
</div>
